<!-- maps/templates/maps/police_stations.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ReportSafer | Police Stations</title>
</head>
<body>
    <h2>Nearest Police Stations</h2>
    <ul>
        <div class="container-fluid col-12 d-flex justify-content-center bg-dark">
            <div class="map" id="myMap" style="width: 90%; height: 500px"></div>
        </div>
        {% for station in police_stations %}
            <li>{{ station.name }} - {{ station.address.formattedAddress }}</li>
        {% endfor %}
    </ul>
</body>
</html>
<!-- Include Bing Maps API script -->
<script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?key=Agyr0UQGWTFzP3Fwb3PDJ_ahP24jx9jRgpUWwBD_37B8MXu1oql6WCs6J-vgU1YT"></script>

<script>
    var map;
    var searchManager;

    function initMap() {
        map = new Microsoft.Maps.Map("#myMap", {
            credentials: "Agyr0UQGWTFzP3Fwb3PDJ_ahP24jx9jRgpUWwBD_37B8MXu1oql6WCs6J-vgU1YT",
            zoom: 10,
        });

        // Retrieve data from Django view and loop through it
        var locations = [
            {% for record in police_stations %}
            {
                latitude: {{ record.point.coordinates.0 }},
                longitude: {{ record.point.coordinates.1 }},
                stname: "{{ record.name }}",
                place: "{{ record.Address.formattedAddress }}"
            },
            {% endfor %}
        ];

        // Create markers for each location
        for (var i = 0; i < locations.length; i++) {
            var location = locations[i];
            var marker = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(location.latitude, location.longitude), {
                title: location.stname,
                subTitle: location.place
            });
            map.entities.push(marker);
        }
    }

    // Call the initMap function once the page is loaded
    window.onload = initMap;
</script>